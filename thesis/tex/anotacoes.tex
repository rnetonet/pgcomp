%% Template para dissertacao/tese na classe UFBAthesis
%% versao 1.0
%% (c) 2005 Paulo G. S. Fonseca
%% (c) 2012 Antonio Terceiro
%% (c) 2014 Christina von Flach
%% www.dcc.ufba.br/~flach/ufbathesis

%% Carrega a classe ufbathesis
%% Opcoes: * Idiomas
%%           pt   - portugues (padrao)
%%           en   - ingles
%%         * Tipo do Texto
%%           bsc  - para monografias de graduacao
%%           msc  - para dissertacoes de mestrado (padrao)
%%           qual - exame de qualificacao de mestrado
%%           prop - exame de qualificacao de doutorado
%%           phd  - para teses de doutorado
%%         * Media
%%           scr  - para versao eletronica (PDF) / consulte o guia do usuario
%%         * Estilo
%%           classic - estilo original a la TAOCP (deprecated) - apesar de deprecated, manter esse.
%%           std     - novo estilo a la CUP (padrao)
%%         * Paginacao
%%           oneside - para impressao em face unica
%%           twoside - para impressao em frente e verso (padrao)

% Aten��o: Manter 'classic' na declaracao abaixo:
\documentclass[qual, classic, a4paper]{ufbathesis}

%% Preambulo:
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{lipsum}
\usepackage{hyphenat}
\usepackage[usenames, dvipsnames, table]{xcolor}
\usepackage{booktabs}
\usepackage{pifont}
\usepackage{multirow}
\usepackage{listings} 
\usepackage{colortbl}
\usepackage{xfrac}
\usepackage[FIGTOPCAP]{subfigure}
\usepackage[printonlyused, withpage]{acronym}

% Universidade
\university{Universidade Federal da Bahia}

% Endereco (cidade)
\address{Salvador}

% Instituto ou Centro Academico
\institute{Instituto de Matem\'{a}tica}

% Nome da biblioteca - usado na ficha catalografica
\library{Biblioteca Reitor Mac\^{e}do Costa}

% Programa de pos-graduacao
\program{Programa de P\'{o}s-Gradua\c{c}\~{a}o em Ci\^{e}ncia da Computa\c{c}\~{a}o}

% Area de titulacao
\majorfield{Ci\^{e}ncia da Computa\c{c}\~{a}o}

% Titulo da dissertacao
\title{Anotações}

% Data da defesa
% e.g. \date{19 de fevereiro de 2013}
\date{-}
% e.g. \defenseyear{2013}
\defenseyear{-}

% Autor
% e.g. \author{Jose da Silva}
\author{Ruivaldo Azevedo Lobão Neto}

% Orientador(a)
% Opcao: [f] - para orientador do sexo feminino
% e.g. \adviser[f]{Profa. Dra. Maria Santos}
\adviser{Ricardo Araujo Rios}

%% Inicio do documento
\begin{document}

%\pgcompfrontpage

%% Parte pre-textual
%\frontmatter

%\pgcomppresentationpage


%%%%%%%%%%%%%%%%%%%%%
% Resumo em Portugues
%%%%%%%%%%%%%%%%%%%%%

\resumo
Anotações realizadas durante a pesquisa exploratória pré-qualificação.

% Palavras-chave do resumo em Portugues
\begin{keywords}
	Concept drift, change-point, detecção de novidades.
\end{keywords}

%%%%%%%%%%%%%%%%%%%
% Sumario / Indice
%%%%%%%%%%%%%%%%%%%

%% Parte textual
\mainmatter

% Eh aconselhavel criar cada capitulo em um arquivo separado, digamos
% "capitulo1.tex", "capitulo2.tex", ... "capituloN.tex" e depois
% inclui-los com:
% \include{capitulo1}
% \include{capitulo2}
% ...
% \include{capituloN}
%
% Importante: 
% Use \xchapter{}{} ao inves de \chapter{}; se n�o quiser colocar texto antes do inicio do capitulo, use \xchapter{texto}{}.

\xchapter{Implementação Pettitt - MOA}{}


A fim de verificar a viabilidade de adaptar métodos estatísticos aplicados ao
problema de \textit{change-point} para detecção de \textit{concept drifts} em
\textit{stream} de dados, foi realizada a implementação do método de Pettitt
\cite{Pettitt} no MOA (https://moa.cms.waikato.ac.nz/).

Observações sobre o método:

\begin{itemize}
	\item \textit{Nonparametric} - Dados não precisam estar numa distribuição normal. Os números observados são ordinais, indicando posição em um ranqueamento
	\item Hipótese \textbf{null}: não houveram mudanças
	\item Não requer conhecimento sobre a distribuição inicial
\end{itemize}

Datasets utilizados:

\begin{itemize}
	\item Page \cite{Page} - de forma contínua (números racionais...tem de -1.05 a 3.29) e como
	      observações de Bernoulli (0, se $<= 0$, 1, se $> 0$). Testes exatos e conservadores.

	\item The Lindisfarne Scribes - binomial (contagem de palavras terminadas em \textit{-s} e \textit{-a}). Acreditava-se que autores diferentes faziam usos diferentes dessas terminações. Testes exatos e conservadores.

	\item Dados industriais. Percentual de uma material em uma sequências de 27 lotes produzidos. Testes aproximados.
\end{itemize}

Outras técnicas citadas por Pettitt. Algumas delas foram, de fato, adaptadas para
técnicas de detecção de \textit{concept drift}:

\begin{itemize}
	\item Page - CUSUM \cite{Page}.

	\item Sen and Srivastava \cite{Sen_and_Srivastava} - Testes no nível da média para um modelo normal.

	\item Hinkley \cite{Hinkley} - Probabilidade entre valor especificado de T e a estimativa de T.

	\item Smith \cite{Smith} considers a Bayesian approach to making inferences about the change-point.

	\item McGilchrist and Woodyer \cite{McGilchrist_and_Woodyer} consider a distribution-free CUSUM and
\end{itemize}

\textbf{Obs:} A maioria desses métodos assume conhecimentos sobre a distribuição inicial dos dados.
O método proposto por Pettitt dispensa esse conhecimento prévio.

\section{Implementação em R}

\begin{verbatim}
    concept.drift<-function(x, plot=T){
        dataS <- length(x)
        vecSize <- 1:dataS
        dataRank <- rank(x)
        sumData <- sapply(vecSize, 
            function(x) 2 * sum(dataRank[1:x]) - x * (dataS + 1))
        absSumData <- abs(sumData)
        maxAbsSumData <- max(absSumData)
        change.point<-vecSize[maxAbsSumData == absSumData]
        if(plot){
            plot(x, t="l", main=paste("Concept Drift:", change.point))
            abline(v=change.point, col="red")
        }
        change.point
    }    
\end{verbatim}

\section{Implementação em Java/MOA}

\begin{verbatim}
    package moa.classifiers.core.driftdetection;

    import com.github.javacliparser.FloatOption;
    import com.github.javacliparser.IntOption;
    import moa.core.ObjectRepository;
    import moa.tasks.TaskMonitor;
    
    import java.util.*;
    
    /**
     * Drift detection method based in Pettitt
     *
     *
     * @author Ruivaldo Neto (rneto@rneto.net)
     * @version $Revision: 7 $
     */
    public class Pettitt extends AbstractChangeDetector {
    
        private static final long serialVersionUID = 5210470661274384763L;
    
        public IntOption minNumInstancesOption = new IntOption(
                "minNumInstances",
                'n',
                "The minimum number of instances before permitting detecting change.",
                100, 0, Integer.MAX_VALUE);
    
    
        private ArrayList<Double> dataList;
        private Integer changePoint;
        private Integer nDataWhenChangePoint;
    
        public Pettitt() {
            resetLearning();
        }
    
        @Override
        public void resetLearning() {
            this.dataList = new ArrayList<Double>();
    
            this.changePoint = null;
            this.nDataWhenChangePoint = null;
    
            this.isChangeDetected = false;
            this.isInitialized = false;
        }
    
        @Override
        public void input(double inputData) {
            if (this.isChangeDetected) {
                this.isChangeDetected = false;
                dataList.add(inputData);
                return;
            }
    
            dataList.add(inputData);
    
            int dataS = dataList.size();
    
            int[] vecSize = new int[dataS];
            for (int i = 1; i <= dataS; i++) {
                vecSize[i - 1] = i;
            }
    
            Double[] data = new Double[dataS];
            dataList.toArray(data);
    
            int[] dataRank = rank(data);
    
            int[] dataRankSum = new int[dataS];
            dataRankSum[0] = dataRank[0];
            for (int i = 1; i < dataRank.length; i++) {
                dataRankSum[i] = dataRank[i] + dataRankSum[i - 1];
            }
    
            int[] sumData = new int[dataS];
            for (int i = 1; i < sumData.length; i++) {
                sumData[i] = (2 * dataRankSum[i]) - (i * (dataS + 1));
            }
    
            int[] absSumData = new int[dataS];
            for (int i = 0; i < absSumData.length; i++) {
                absSumData[i] = Math.abs(sumData[i]);
            }
    
            Integer maxAbsSumData = Arrays.stream(absSumData).max().getAsInt();
    
            // Find Index
            int newChangePoint = 0;
            for (newChangePoint = 0; newChangePoint < absSumData.length; newChangePoint++) {
                if (absSumData[newChangePoint] == maxAbsSumData) {
                    break;
                }
            }
    
            // First Index
            if (this.changePoint == null) {
                this.changePoint = newChangePoint;
                this.nDataWhenChangePoint = this.dataList.size();
                return;
            }
    
            // If different, concept drift
            int changePointDelta = newChangePoint - this.changePoint;
            int nDataDelta = dataList.size() - this.nDataWhenChangePoint;
    
            if (changePointDelta >= this.minNumInstancesOption.getValue() && changePointDelta >= nDataDelta / 2 + 1) {
                this.changePoint = newChangePoint;
                this.nDataWhenChangePoint = this.dataList.size();
    
                this.isChangeDetected = true;
    
                return;
            }
        }
    
        private static int[] rank(Double[] x){
            int [] R = new int[x.length];
            if(x.length == 0)return R;
            Integer [] I = new Integer[x.length];
            for(int i = 0; i < x.length; i++) {
                I[i] = i;
            }
            Arrays.sort(I, (i0, i1) -> (int) Math.signum(x[i0]-x[i1]));
            int j = 0;
            for(int i = 0; i < x.length; i++){
                if(x[I[i]] != x[I[j]])
                    j = i;
                R[I[i]] = j;
            }
            return R;
        }
    
        @Override
        public void getDescription(StringBuilder sb, int indent) {
            // TODO Auto-generated method stub
        }
    
        @Override
        protected void prepareForUseImpl(TaskMonitor monitor,
                                         ObjectRepository repository) {
            // TODO Auto-generated method stub
        }
    }
\end{verbatim}

Considerações a cerca da implementação e testes:

\begin{itemize}
    \item Detecta mesmo quando não há drift;
    \item Muito sensível;
    \item Necessário adequar um método de janela (?)
\end{itemize}

\xchapter{Artigos}{}

\section{DetectA: abrupt concept drift detection in non-stationary \cite{ESCOVEDO2018119}}

\begin{itemize}
    \item \textit{Concept Drift} é bastante comum. A maior parte dos problemas reais, tem que lidar
    \item É fruto de ambientes não estacionários
    \item Os problemas de classificação são os mais afetados, pois as predições acabam invalidadas
    \item Atualizar o modelo frequentemente mitiga, mas é custoso
    \item Tipos de \textit{Concept Drift}:
    \begin{itemize}
        \item \textit{Abrupt / Sudden} - Conceito A é substituído imediatamente pelo Conceito B
        \item \textit{Gradual} - Dados do Conceito B tornam-se gradativamente mais presentes, até tornarem-se maioria.
        Não há de fato a mudança cabal de A para B, apenas a maior presença de B. 
        No começo, B pode ser entendido com ruído
    \end{itemize}
    \item Formas de lidar com \textit{Concept Drift}:
    \begin{itemize}
        \item \textit{Passive / Reactive}: Passe o dado por modelo. Detecta mudança a partir do incremento da taxa de erro da predição
        \item \textit{Proactive}: Detecta a mudança antes da predição, podendo trazer resultados mais satisfatórios.
    \end{itemize}
    \item O \textit{DetectA} é uma continuação do trabalho \textbf{A2D2: A pre-event abrupt drift detection} \cite{Escovedo2015A2D2AP}
    \item Nomeclaturas utilizadas para se referir a \textit{Concept Drift}: \textit{Change Detection}
    \item Entendido como técnica para detectar \textit{Change Point}  e \textit{Small Intervals - Drift}
    \item \textit{Concept Drift Detectors}:
    \begin{itemize}
        \item Metodologias para detecção de mudanças na distribuição dos dados
        \item Pode utilizar dados da performance do classificador (\textit{error rate}) ou os próprios dados
        \item Normalmente observam as seguintes características dos dados:
        \begin{itemize}
            \item Desvio Padrão
            \item \textit{Error rate} do modelo
            \item \textit{Instance Distribution}
            \item Estabilidade
        \end{itemize}
    \end{itemize}

    \item Foco do trabalho é em Classificação. Mas \textit{Concept Drift} ocorre em regressões, séries temporais, etc, também
    \item Outros métodos pró-ativos citados:
    \begin{itemize}
        \item \textit{PCA Feature Extraction for Change Detection in Multidimensional Unlabeled Data} \cite{PCAFeatureExtractionChangeDetection}: 
        \begin{itemize}
            \item Extrai componentes (PCA)
            \item Componentes com menor variância são mais sensíveis à mudança
            \item Usa esses componentes através do método semi-paramétrico e \textit{log-likelihood} para detectar mudanças na média e variância
        \end{itemize}

        \item \textit{Proactive drift detection: Predicting concept drifts in data streams using probabilistic networks} \cite{ProactiveDriftDetectionProbabilistic}: 
        \begin{itemize}
            \item Utiliza um histórico das taxas de mudança
            \item Diminui o número de detecção de falsos positivos
            \item Limitação: Usa a informação do intervalo do drift apenas para predizar novos locais de drift, comparando padrões
        \end{itemize}
    \end{itemize}

    \item Resumo do \textbf{DetectA}:
    \begin{itemize}
        \item Agrupa os dados em clustes através de alg. não supervisionado (\textit{test data} e \textit{training data})
        \item Cálculo estatísticos (matrizes de média e covariância) dos dados de treinamento e teste, condicionados aos clusters do passo 1, são calculadas
        \item Resultados são comparados e analisados. Se um limite é ultrapassado, drift é identificado
        \item \textit{* Suporta metodologia reativa e proativa:}
        \begin{itemize}
            \item \textbf{Reativa:} Requer que os dados no instante $t$ e $t + 1$ tenham \textit{labels}. 
            Não utiliza algoritmos de clusterização. Simplesmente calcula e compara $t$ e $t + 1$.
            \item \textbf{Pró-ativa:} No instante $t + 1$, não existem \textit{labels}. A comparação é feita através da formação de clusters usando um algoritmo não-supervisionado aglomerativo (\textit{k-means}).

            Observações sobre o uso do algoritmo não-supervisionado aglobmerativo:
            \begin{itemize}
                \item Números de grupos a serem formados é conhecido (número de classes do problema)
                \item Centróide inicial é a média condicional do vetor de cada classe
                \item Mais eficiente que métodos divisivos
            \end{itemize}
        \end{itemize}
    \end{itemize}

    \item Conclusões:
    \begin{itemize}
        \item O detector é eficiente e compatível com datasets de grande dimensionalidade, blocos de tamanho médio, para qualquer proporção de drift e balanceamento de classes
        \item O trabalho também propõe um procedimento para produzir datasets com drifts abruptos
    \end{itemize}

    \item Trabalhos Futuros:
    \begin{itemize}
        \item Metodologia para evitar o escolha ad-hoc do algoritmo de clusterização (teste com vários, análise da silhoueta ou outro índice)
        \item Testar a técnica com um método de classificação mais complexo, \textit{ensembles} de redes neurais ou abordagens neuro evolutivas
        \item Abordagem híbrida, combinando método pró-ativo e reativo. Ao receber dados, o método pró-ativo é aplicado. Se não for detectado drift, classificação é realizada. Quando os labels corretos chegarem, o reativo é executado. Se drift for detectado, modelo é retreinado.
    \end{itemize}

\end{itemize}

\xchapter{Algoritmos MOA}{}

...

%% Parte pos-textual
\backmatter

% Bibliografia
% � aconselh�vel utilizar o BibTeX a partir de um arquivo, digamos "biblio.bib".
% Para ajuda na cria��o do arquivo .bib e utiliza��o do BibTeX, recorra ao
% BibTeXpress em www.cin.ufpe.br/~paguso/bibtexpress
\bibliographystyle{abntex2-alf}
\bibliography{biblio}

%% Fim do documento
\end{document}
%------------------------------------------------------------------------------------------%
